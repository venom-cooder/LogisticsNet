<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Dashboard - Logistics Net</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #00000a; --nav-bg: rgba(10, 10, 20, 0.5); --card-bg: rgba(20, 20, 35, 0.6);
            --border-color: rgba(255, 255, 255, 0.1); --primary-blue: #00aaff; --text-primary: #ffffff;
            --text-secondary: #a9a9b3; --green: #4caf50; --yellow: #fbc02d; --red: #d32f2f;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-primary); overflow-x: hidden; }
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .top-nav { position: fixed; top: 0; left: 0; width: 100%; background: var(--nav-bg); border-bottom: 1px solid var(--border-color); backdrop-filter: blur(15px); z-index: 100; padding: 0 2rem; display: flex; align-items: center; height: 70px; }
        .main-container { padding: 100px 3rem 2rem; }
        .nav-logo { font-size: 1.8rem; font-weight: 700; color: var(--text-primary); text-decoration: none; }
        .nav-logo span { color: var(--primary-blue); }
        .nav-links { display: flex; margin-left: 3rem; }
        .nav-links a { color: var(--text-secondary); text-decoration: none; padding: 0 1.5rem; font-weight: 600; line-height: 70px; border-bottom: 3px solid transparent; transition: color 0.3s ease, border-color 0.3s ease; cursor: pointer; }
        .nav-links a:hover { color: var(--text-primary); }
        .nav-links a.active { color: var(--text-primary); border-bottom-color: var(--primary-blue); }
        .nav-actions { margin-left: auto; display: flex; align-items: center; gap: 1.5rem; }
        .membership-status { background-color: rgba(0, 170, 255, 0.1); border: 1px solid var(--primary-blue); color: var(--primary-blue); padding: 8px 16px; border-radius: 6px; font-weight: 600; font-size: 0.9rem; }
        .logout-btn { background-color: rgba(255, 255, 255, 0.1); color: var(--text-primary); padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; transition: background-color 0.3s ease; }
        .logout-btn:hover { background-color: rgba(255, 255, 255, 0.2); }
        .main-header { margin-bottom: 2.5rem; display: flex; justify-content: space-between; align-items: center; }
        .main-header h1 { font-size: 2.25rem; }
        .page-content { display: none; }
        .page-content.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .dashboard-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 1.5rem; }
        .main-panel { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 2rem; }
        .panel-title { font-size: 1.5rem; margin-bottom: 1.5rem; }
        .btn { display: inline-block; padding: 12px 28px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; color: var(--text-primary); cursor: pointer; text-decoration: none; transition: background-color 0.3s ease; background-color: var(--primary-blue); }
        .btn:hover { background-color: #0088cc; }
        .btn:disabled { background-color: #555; cursor: not-allowed; }
        .planner-panel { grid-column: span 5; }
        .results-panel { grid-column: span 7; }
        .input-group { margin-bottom: 1.5rem; }
        .input-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-secondary); }
        .input-group select, .input-group input { width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid var(--border-color); border-radius: 8px; color: #fff; font-size: 1rem; }
        .waypoint-group { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
        .remove-waypoint-btn { background: var(--red); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-weight: bold; flex-shrink: 0; }
        .choice-card-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .choice-card { background: rgba(0,0,0,0.2); padding: 1.5rem 1rem; border-radius: 8px; text-align: center; cursor: pointer; border: 2px solid var(--border-color); transition: border-color 0.3s ease, background-color 0.3s ease; }
        .choice-card:hover { background-color: rgba(255,255,255,0.05); }
        .choice-card.active { border-color: var(--primary-blue); }
        .choice-card .icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .results-placeholder { text-align: center; padding: 4rem 2rem; color: var(--text-secondary); }
        .results-placeholder .icon { font-size: 4rem; margin-bottom: 1rem; }
        .recommendation-wrapper { display: none; }
        .recommendation-card { background: rgba(0,0,0,0.2); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid; }
        .recommendation-card.top-choice { border-color: var(--green); }
        .recommendation-card.value { border-color: var(--primary-blue); }
        .rec-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .rec-header h4 { font-size: 1.2rem; }
        .rec-header-actions { display: flex; align-items: center; gap: 1rem; }
        .get-info-btn { padding: 6px 12px; font-size: 0.8rem; background-color: rgba(255, 255, 255, 0.1); border: 1px solid var(--border-color); }
        .get-info-btn:hover { background-color: rgba(255, 255, 255, 0.2); }
        .rec-header .tag { font-size: 0.8rem; font-weight: 600; padding: 4px 10px; border-radius: 20px; color: #000; }
        .tag.top-choice { background-color: var(--green); color: #fff; }
        .tag.value { background-color: var(--primary-blue); color: #fff; }
        .rec-details { display: flex; gap: 1rem; align-items: center; }
        .rec-details img { height: 40px; width: 80px; object-fit: contain; background: #fff; border-radius: 6px; padding: 4px; }
        .rec-info p { margin: 0; }
        .rec-contact { margin-left: auto; text-align: right; }
        .rec-contact p { font-size: 0.9rem; color: var(--text-secondary); }
        .panel-shipment-status { grid-column: span 4; }
        .panel-monthly-spend { grid-column: span 8; }
        .panel-partner-performance { grid-column: span 5; }
        .panel-rate-fluctuation { grid-column: span 7; }
        .panel-ongoing-shipments { grid-column: span 12; }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 1rem; text-align: left; border-bottom: 1px solid var(--border-color); }
        .status-tag { font-weight: 600; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; display: inline-block; }
        .status-open { background-color: var(--red); }
        .status-resolved { background-color: var(--green); }
        .opportunity-panel { grid-column: span 12; background: linear-gradient(45deg, rgba(251, 192, 45, 0.1), rgba(211, 47, 47, 0.1)); border-color: var(--yellow);}
        .opportunity-content { display: flex; justify-content: space-between; align-items: center; }
        #map { height: 400px; width: 100%; border-radius: 12px; background-color: rgba(0,0,0,0.3); }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>
    <header class="top-nav">
        <a href="#" class="nav-logo">Logistics<span>Net</span></a>
        <nav class="nav-links">
            <a data-page="overview" class="active">Business Overview</a>
            <a data-page="planner">Plan New Shipment</a>
            <a data-page="issues">Issues & Complaints</a>
        </nav>
        <div class="nav-actions">
            <div id="membership-status" class="membership-status"></div>
            <a href="index.html" class="logout-btn">Log Out</a>
        </div>
    </header>

    <main class="main-container">
        <!-- ===== Overview Page ===== -->
        <div id="overview-page" class="page-content active">
            <header class="main-header"><h1>Business Overview</h1></header>
            <div class="dashboard-grid">
                <section class="main-panel panel-shipment-status"><h2 class="panel-title">Shipment Status</h2><canvas id="shipmentStatusChart"></canvas></section>
                <section class="main-panel panel-monthly-spend"><h2 class="panel-title">Monthly Logistics Spend</h2><canvas id="monthlySpendChart"></canvas></section>
                <section class="main-panel panel-ongoing-shipments">
                     <h2 class="panel-title">Ongoing Shipments</h2>
                      <table style="width:100%; border-collapse: collapse;"><tbody>
                            <tr><td style="padding:1rem;">#B-124</td><td><img src="https://logo.clearbit.com/safexpress.com" style="height:25px; vertical-align:middle;" onerror="this.style.display='none'"> SafeStore</td><td>Bhopal to Jabalpur</td><td>In Transit</td></tr>
                            <tr><td style="padding:1rem;">#B-123</td><td><img src="https://logo.clearbit.com/dhl.com" style="height:25px; vertical-align:middle;" onerror="this.style.display='none'"> DHL</td><td>Delhi to Mumbai</td><td>Out for Delivery</td></tr>
                      </tbody></table>
                </section>
                <section class="main-panel opportunity-panel">
                    <div class="opportunity-content">
                        <div>
                            <h2 class="panel-title" style="color: var(--yellow);">Optimization Opportunity Detected</h2>
                            <p style="color: var(--text-secondary);">Our AI has detected a high damage report rate (15%) for your shipments to <strong>Delhi</strong> with your current primary partner.</p>
                        </div>
                        <button id="find-partner-btn" class="btn">Find a Better Partner with LogAi</button>
                    </div>
                </section>
                <section class="main-panel panel-partner-performance"><h2 class="panel-title">Partner Performance</h2><canvas id="partnerPerformanceChart"></canvas></section>
                <section class="main-panel panel-rate-fluctuation"><h2 class="panel-title">Rate Fluctuation (Bhopal to Indore)</h2><canvas id="rateFluctuationChart"></canvas></section>
            </div>
        </div>

        <!-- ===== Planner Page ===== -->
        <div id="planner-page" class="page-content">
             <div class="dashboard-grid">
                <section class="main-panel" style="grid-column: span 12;"><h2 class="panel-title">Route Visualization</h2><div id="map"></div></section>
                <section class="main-panel planner-panel">
                    <h2 class="panel-title">New Shipment Planner</h2>
                    <form id="planner-form">
                        <div class="input-group"><label>1. Define Route</label>
                            <div class="waypoint-group"><input type="text" value="Bhopal" disabled></div>
                            <div id="waypoints-container"></div>
                            <button type="button" id="add-waypoint-btn" class="btn btn-secondary" style="width: auto; padding: 8px 16px; font-size: 0.9rem;">+ Add Waypoint/Destination</button>
                        </div>
                        <div class="input-group"><label>2. What is your business type?</label><select id="business-type"><option>General Goods</option><option>Electronics</option><option>Pharma</option><option>Manufacturing</option><option>Textiles</option></select></div>
                        <div class="input-group"><label>3. How fragile are the goods?</label><select id="fragility"><option>Low</option><option>Medium</option><option>High</option></select></div>
                        <div class="input-group"><label>4. Approximate shipment value (INR)?</label>
                            <select id="shipment-value">
                                <option>Under 50,000</option><option>50,000 - 2 Lakh</option><option>2 Lakh - 5 Lakh</option>
                                <option>5 Lakh - 10 Lakh</option><option>Over 10 Lakh</option>
                            </select>
                        </div>
                        <div class="input-group"><label>5. What are your main priorities? (Select up to 2)</label>
                            <div class="choice-card-grid" id="priority-selector">
                                <div class="choice-card active" data-priority="cost"><div class="icon">💰</div><div>Lowest Cost</div></div>
                                <div class="choice-card" data-priority="speed"><div class="icon">⚡️</div><div>Fastest</div></div>
                                <div class="choice-card" data-priority="safety"><div class="icon">🛡️</div><div>Highest Safety</div></div>
                                <div class="choice-card" data-priority="warehouse"><div class="icon">📦</div><div>Best Warehouse</div></div>
                            </div>
                        </div>
                        <button type="submit" class="btn" style="width: 100%; padding: 16px; font-size: 1.2rem;">Generate with LogAi</button>
                    </form>
                </section>
                <section class="main-panel results-panel">
                    <h2 class="panel-title">LogAi Recommendations</h2>
                    <div id="results-placeholder" class="results-placeholder">
                        <div class="icon">🤖</div><h3>Your AI-powered recommendations will appear here.</h3>
                    </div>
                    <div id="recommendation-wrapper" class="recommendation-wrapper"></div>
                </section>
            </div>
        </div>

        <!-- ===== Issues Page ===== -->
        <div id="issues-page" class="page-content">
            <header class="main-header"><h1>Issues & Complaints</h1></header>
            <div class="main-panel">
                 <table class="data-table">
                    <thead><tr><th>Issue ID</th><th>Shipment ID</th><th>Partner</th><th>Complaint</th><th>Status</th></tr></thead>
                    <tbody>
                        <tr><td>#C-001</td><td>#B-119</td><td>DTDC</td><td>Package Damaged</td><td><span class="status-tag status-open">Open</span></td></tr>
                        <tr><td>#C-002</td><td>#B-115</td><td>Gati</td><td>Shipment Delayed</td><td><span class="status-tag status-resolved">Resolved</span></td></tr>
                    </tbody>
                 </table>
             </div>
        </div>
    </main>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script type="module">
        // --- 3D Background Setup ---
        const canvas = document.getElementById('bg-canvas');
        let scene, camera, renderer, neptune, stars, asteroidBelt;
        
        function init3D() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.position.z = 25;
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
            scene.add(ambientLight);
            const pointLight = new THREE.PointLight(0xffffff, 0.8);
            pointLight.position.set(50, 50, 50);
            scene.add(pointLight);

            const textureLoader = new THREE.TextureLoader();
            const neptuneTexture = textureLoader.load('https://raw.githubusercontent.com/jeromeetienne/threex.planets/master/images/neptunemap.jpg');
            const neptuneMaterial = new THREE.MeshPhongMaterial({ map: neptuneTexture, bumpScale: 0.05, specular: new THREE.Color('grey') });
            const neptuneGeometry = new THREE.SphereGeometry(8, 64, 64);
            neptune = new THREE.Mesh(neptuneGeometry, neptuneMaterial);
            neptune.position.x = -25;
            scene.add(neptune);

            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.15, transparent: true, opacity: 0.8 });
            const starVertices = [];
            for (let i = 0; i < 10000; i++) {
                starVertices.push((Math.random() - 0.5) * 2000, (Math.random() - 0.5) * 2000, -Math.random() * 1500);
            }
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);

            asteroidBelt = new THREE.Group();
            const asteroidGeometry = new THREE.IcosahedronGeometry(1, 0);
            const asteroidMaterial = new THREE.MeshStandardMaterial({ color: 0xaaaaaa, roughness: 0.8 });
            for (let i = 0; i < 1500; i++) {
                const asteroid = new THREE.Mesh(asteroidGeometry, asteroidMaterial);
                const angle = Math.random() * Math.PI * 2;
                const radius = 40 + Math.random() * 40;
                asteroid.position.set(Math.cos(angle) * radius, (Math.random() - 0.5) * 8, Math.sin(angle) * radius);
                asteroid.scale.setScalar(Math.random() * 0.4 + 0.1);
                asteroid.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI);
                asteroidBelt.add(asteroid);
            }
            scene.add(asteroidBelt);

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            animate3D();
        }
        
        const clock = new THREE.Clock();
        let mouseX = 0;
        document.addEventListener('mousemove', (event) => { mouseX = (event.clientX / window.innerWidth) * 2 - 1; });

        function animate3D() {
            requestAnimationFrame(animate3D);
            const elapsedTime = clock.getElapsedTime();
            if (neptune) neptune.rotation.y = elapsedTime * 0.05;
            if (stars) stars.rotation.y = elapsedTime * 0.005;
            if (asteroidBelt) asteroidBelt.rotation.y = elapsedTime * 0.02;

            camera.position.x += (mouseX * 5 - camera.position.x) * 0.02;
            camera.lookAt(scene.position);
            renderer.render(scene, camera);
        }
        init3D();
        
        // --- Page Navigation & UI Logic ---
        const navLinks = document.querySelectorAll('.nav-links a');
        const pages = document.querySelectorAll('.page-content');
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                const pageId = link.dataset.page;
                navLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                pages.forEach(page => page.classList.toggle('active', page.id === `${pageId}-page`));
            });
        });
        
        // --- Chart.js Logic ---
        const chartTextColor = 'rgba(255,255,255,0.7)'; const chartGridColor = 'rgba(255,255,255,0.1)';
        new Chart(document.getElementById('shipmentStatusChart'), { type: 'doughnut', data: { labels: ['In Transit', 'Delivered', 'Pending'], datasets: [{ data: [2, 342, 8], backgroundColor: ['#f9a825', '#2e7d32', '#d32f2f'] }] }, options: { responsive: true, plugins: { legend: { position: 'bottom', labels: { color: chartTextColor } } } } });
        const spendCtx = document.getElementById('monthlySpendChart').getContext('2d');
        const gradient = spendCtx.createLinearGradient(0, 0, 0, spendCtx.canvas.height);
        gradient.addColorStop(0, 'rgba(0, 170, 255, 0.5)');
        gradient.addColorStop(1, 'rgba(0, 170, 255, 0)');
        new Chart(spendCtx, { type: 'line', data: { labels: ['Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug'], datasets: [{ label: 'Spend (in ₹)', data: [120000, 150000, 145000, 180000, 160000, 157000], borderColor: 'var(--primary-blue)', tension: 0.4, fill: true, backgroundColor: gradient }] }, options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { ticks: { color: chartTextColor }, grid: { color: chartGridColor } }, x: { ticks: { color: chartTextColor }, grid: { color: chartGridColor } } } } });
        new Chart(document.getElementById('partnerPerformanceChart'), { type: 'radar', data: { labels: ['Cost', 'Speed', 'Reliability', 'Support'], datasets: [ { label: 'DHL', data: [7, 9, 9, 8], borderColor: '#ffc107', backgroundColor: 'rgba(255, 193, 7, 0.2)'}, { label: 'LogisticStartup', data: [9, 8, 10, 9], borderColor: '#00aaff', backgroundColor: 'rgba(0, 170, 255, 0.2)'} ] }, options: { responsive: true, plugins: { legend: { labels: { color: chartTextColor } } }, scales: { r: { pointLabels: { color: chartTextColor }, grid: { color: chartGridColor }, angleLines: { color: chartGridColor } } } } });
        new Chart(document.getElementById('rateFluctuationChart'), { type: 'bar', data: { labels: ['Apr', 'May', 'Jun', 'Jul', 'Aug'], datasets: [{ label: 'Avg Cost/kg (₹)', data: [22, 21, 24, 23, 25], backgroundColor: 'rgba(0, 170, 255, 0.6)' }] }, options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { ticks: { color: chartTextColor }, grid: { color: chartGridColor } }, x: { ticks: { color: chartTextColor }, grid: { color: chartGridColor } } } } });
        
        // --- Membership Timer ---
        const membershipEl = document.getElementById('membership-status');
        const endDate = new Date().getTime() + (30 * 24 * 60 * 60 * 1000);
        const timerInterval = setInterval(() => {
            const now = new Date().getTime(); const distance = endDate - now;
            const d = Math.floor(distance / (1000 * 60 * 60 * 24)); const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)); const s = Math.floor((distance % (1000 * 60)) / 1000);
            membershipEl.innerHTML = `Pro Member: ${d}d ${h}h ${m}m ${s}s left`;
            if (distance < 0) { clearInterval(timerInterval); membershipEl.innerHTML = "Membership Expired"; }
        }, 1000);

        // --- Multi-Stop Planner Logic ---
        const waypointsContainer = document.getElementById('waypoints-container');
        const addWaypointBtn = document.getElementById('add-waypoint-btn');
        const availableLocations = ['Indore', 'Delhi', 'Pune', 'Ahmedabad', 'Kolkata'];
        function createWaypointInput(isFirst = false) {
            const group = document.createElement('div');
            group.className = 'waypoint-group';
            let optionsHtml = availableLocations.map(loc => `<option>${loc}</option>`).join('');
            group.innerHTML = `<select class="waypoint-select">${optionsHtml}</select>${!isFirst ? '<button type="button" class="remove-waypoint-btn">-</button>' : ''}`;
            if (!isFirst) { group.querySelector('.remove-waypoint-btn').addEventListener('click', () => group.remove()); }
            waypointsContainer.appendChild(group);
        }
        createWaypointInput(true);
        addWaypointBtn.addEventListener('click', () => createWaypointInput());

        // --- AI API Call Logic ---
        const plannerForm = document.getElementById('planner-form');
        const prioritySelector = document.getElementById('priority-selector');
        const BACKEND_URL = 'https://logistics-net-backend.onrender.com';

        plannerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const generateBtn = e.target.querySelector('button[type="submit"]');
            const waypoints = Array.from(document.querySelectorAll('.waypoint-select')).map(s => s.value);
            const destination = waypoints[waypoints.length - 1]; 
            const fragility = document.getElementById('fragility').value;
            const selectedPriorities = Array.from(prioritySelector.querySelectorAll('.choice-card.active')).map(c => c.dataset.priority);
            
            if (selectedPriorities.length === 0) { alert("Please select at least one priority."); return; }

            const wrapper = document.getElementById('recommendation-wrapper');
            document.getElementById('results-placeholder').style.display = 'none';
            wrapper.style.display = 'block';
            wrapper.innerHTML = `<div class="results-placeholder"><div class="icon">🧠</div><h3>LogAi is thinking...</h3></div>`;
            generateBtn.disabled = true; generateBtn.textContent = 'Generating...';

            try {
                const response = await fetch(`${BACKEND_URL}/api/recommend`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ origin: 'Bhopal', destination, priorities: selectedPriorities, fragility })
                });

                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || 'Failed to get a recommendation.'); }
                const recs = await response.json();
                displayRecommendations(recs, selectedPriorities);
            } catch (error) {
                console.error("API Call failed:", error);
                wrapper.innerHTML = `<div class="results-placeholder" style="color: var(--red);"><h3>Error</h3><p>${error.message}</p></div>`;
            } finally {
                generateBtn.disabled = false; generateBtn.textContent = 'Generate with LogAi';
            }
        });
        
        prioritySelector.addEventListener('click', (e) => {
            const card = e.target.closest('.choice-card');
            if (!card) return;
            const activeCards = prioritySelector.querySelectorAll('.choice-card.active');
            if (activeCards.length < 2 || card.classList.contains('active')) {
                card.classList.toggle('active');
            } else { activeCards[0].classList.remove('active'); card.classList.add('active'); }
        });

        function displayRecommendations(recs, priorities) {
            const wrapper = document.getElementById('recommendation-wrapper');
            wrapper.innerHTML = '';
            const createCard = (company, type) => {
                if (!company || !company.name) return '';
                const typeMap = { top_choice: 'Top Choice', value_pick: 'Value Pick' };
                const classMap = { top_choice: 'top-choice', value_pick: 'value' };
                const infoUrl = `company_details.html?company=${encodeURIComponent(company.name)}&priorities=${priorities.join(',')}`;

                return `<div class="recommendation-card ${classMap[type]}">
                    <div class="rec-header">
                        <h4>${company.name}</h4>
                        <div class="rec-header-actions">
                             <a href="${infoUrl}" class="btn get-info-btn">Get Complete Information</a>
                             <span class="tag ${classMap[type]}">${typeMap[type]}</span>
                        </div>
                    </div>
                    <div class="rec-details">
                        <img src="https://logo.clearbit.com/${company.domain}" onerror="this.style.display='none'">
                        <div class="rec-info"><p><strong>Hub:</strong> ${company.hub}</p><p><strong>Bhopal Center:</strong> ${company.bhopal_address}</p></div>
                        <div class="rec-contact"><p>Customer Care:</p><p><strong>${company.care_number}</strong></p></div>
                    </div>
                </div>`;
            };
            wrapper.innerHTML += createCard(recs.top_choice, 'top_choice');
            wrapper.innerHTML += createCard(recs.value_pick, 'value_pick');
            wrapper.style.display = 'block';
        }

        // "Find a Better Partner" button logic
        document.getElementById('find-partner-btn').addEventListener('click', () => {
            navLinks.forEach(l => l.classList.remove('active'));
            document.querySelector('a[data-page="planner"]').classList.add('active');
            pages.forEach(page => page.classList.toggle('active', page.id === 'planner-page'));
            
            const waypointSelects = waypointsContainer.querySelectorAll('.waypoint-select');
            if (waypointSelects.length > 0) {
                const lastSelect = waypointsContainer.querySelector('.waypoint-select:last-of-type');
                if(Array.from(lastSelect.options).some(o => o.value === 'Delhi')) {
                    lastSelect.value = 'Delhi';
                }
            }
            
            const safetyCard = prioritySelector.querySelector('[data-priority="safety"]');
            if (safetyCard) {
                prioritySelector.querySelectorAll('.choice-card').forEach(c => c.classList.remove('active'));
                safetyCard.classList.add('active');
            }
        });
    </script>
    <!-- Google Maps API Script -->
    <script>
        let map;
        function initMap() {
            const bhopal = { lat: 23.2599, lng: 77.4126 };
            map = new google.maps.Map(document.getElementById("map"), {
                center: bhopal,
                zoom: 5,
                styles: [ { "elementType": "geometry", "stylers": [ { "color": "#242f3e" } ] }, { "elementType": "labels.text.stroke", "stylers": [ { "color": "#242f3e" } ] }, { "elementType": "labels.text.fill", "stylers": [ { "color": "#746855" } ] }, { "featureType": "administrative.locality", "elementType": "labels.text.fill", "stylers": [ { "color": "#d59563" } ] }, { "featureType": "poi", "elementType": "labels.text.fill", "stylers": [ { "color": "#d59563" } ] }, { "featureType": "poi.park", "elementType": "geometry", "stylers": [ { "color": "#263c3f" } ] }, { "featureType": "poi.park", "elementType": "labels.text.fill", "stylers": [ { "color": "#6b9a76" } ] }, { "featureType": "road", "elementType": "geometry", "stylers": [ { "color": "#38414e" } ] }, { "featureType": "road", "elementType": "geometry.stroke", "stylers": [ { "color": "#212a37" } ] }, { "featureType": "road", "elementType": "labels.text.fill", "stylers": [ { "color": "#9ca5b3" } ] }, { "featureType": "road.highway", "elementType": "geometry", "stylers": [ { "color": "#746855" } ] }, { "featureType": "road.highway", "elementType": "geometry.stroke", "stylers": [ { "color": "#1f2835" } ] }, { "featureType": "road.highway", "elementType": "labels.text.fill", "stylers": [ { "color": "#f3d19c" } ] }, { "featureType": "transit", "elementType": "geometry", "stylers": [ { "color": "#2f3948" } ] }, { "featureType": "transit.station", "elementType": "labels.text.fill", "stylers": [ { "color": "#d59563" } ] }, { "featureType": "water", "elementType": "geometry", "stylers": [ { "color": "#17263c" } ] }, { "featureType": "water", "elementType": "labels.text.fill", "stylers": [ { "color": "#515c6d" } ] }, { "featureType": "water", "elementType": "labels.text.stroke", "stylers": [ { "color": "#17263c" } ] } ]
            });
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDpD4LkB8Wo9v5YQh3v-9vdehUf6JMkTTU" async defer></script>
</body>
</html>
